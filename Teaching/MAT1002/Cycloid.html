<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trochoids & Spirograph Visualization</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; background: #fdfdfd; }
    .sidebar { width: 360px; padding: 25px; background: white; box-shadow: 2px 0 15px rgba(0,0,0,0.1); overflow-y: auto; }
    #plot-container { flex-grow: 1; padding: 15px; }
    #plot { width: 100%; height: 100%; background: white; border-radius: 12px; }
    .control-group { margin-bottom: 15px; }
    label { display: block; font-weight: bold; font-size: 0.85rem; color: #333; margin-bottom: 5px; }
    select, input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
    .slider-box { background: #f0f4f8; padding: 15px; border-radius: 8px; border: 1px solid #d1d9e6; margin: 15px 0; }
    .highlight { color: #d32f2f; font-weight: bold; }
    button { width: 100%; padding: 12px; background: #4caf50; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
    .note { font-size: 0.8rem; color: #666; font-style: italic; margin-top: 10px; }
  </style>
</head>
<body>

<div class="sidebar">
  <h3>Trochoid Explorer</h3>
  
  <div class="control-group">
    <label>Base Geometry</label>
    <select id="curveType" onchange="resetAndPlot()">
      <option value="cycloid">Linear (Standard Trochoid)</option>
      <option value="epicycloid">Epitrochoid (Outside Circle)</option>
      <option value="hypocycloid">Hypotrochoid (Inside Circle)</option>
    </select>
  </div>

  <div class="control-group">
    <label>Fixed Radius (R)</label>
    <input type="number" id="radiusR" value="5" step="0.5" onchange="resetAndPlot()">
  </div>

  <div class="control-group">
    <label>Rolling Radius (r)</label>
    <input type="number" id="radiusSmall" value="2" step="0.1" onchange="resetAndPlot()">
  </div>

  <div class="control-group">
    <label>Tracing Distance (d)</label>
    <input type="number" id="distD" value="2" step="0.1" onchange="updatePlot()">
    <div class="note">If d = r, it's a standard cycloid.</div>
  </div>

  <div class="slider-box">
    <label>Rotation (t): <span id="tVal" class="highlight">0</span></label>
    <input type="range" id="tSlider" min="0" max="31.4" step="0.1" value="0" oninput="updateTime()">
  </div>

  <button onclick="clearTrace()">Clear Drawing</button>

  <div class="note" style="margin-top:20px;">
    <b>Professor's Tip:</b> Set <i>d > r</i> to see the curve form loops (Prolate). Set <i>d < r</i> for a smoother wave (Curtate).
  </div>
</div>

<div id="plot-container">
  <div id="plot"></div>
</div>

<script>
let traceX = [], traceY = [];

function updateTime() {
  document.getElementById('tVal').innerText = document.getElementById('tSlider').value;
  updatePlot();
}

function resetAndPlot() { clearTrace(); }
function clearTrace() { traceX = []; traceY = []; updatePlot(); }

function updatePlot() {
  const type = document.getElementById('curveType').value;
  const R = parseFloat(document.getElementById('radiusR').value);
  const r = parseFloat(document.getElementById('radiusSmall').value);
  const d = parseFloat(document.getElementById('distD').value);
  const t = parseFloat(document.getElementById('tSlider').value);

  let px, py, cx, cy, baseData = [];

  if (type === 'cycloid') {
    cx = r * t; cy = r;
    px = r * t - d * Math.sin(t);
    py = r - d * Math.cos(t);
    baseData = [{ x: [-2, 40], y: [0, 0], mode: 'lines', line: {color: '#333'} }];
  } else if (type === 'epicycloid') {
    cx = (R + r) * Math.cos(t); cy = (R + r) * Math.sin(t);
    px = (R + r) * Math.cos(t) - d * Math.cos((R + r)/r * t);
    py = (R + r) * Math.sin(t) - d * Math.sin((R + r)/r * t);
    baseData = createCircle(0, 0, R, '#333');
  } else {
    cx = (R - r) * Math.cos(t); cy = (R - r) * Math.sin(t);
    px = (R - r) * Math.cos(t) + d * Math.cos((R - r)/r * t);
    py = (R - r) * Math.sin(t) - d * Math.sin((R - r)/r * t);
    baseData = createCircle(0, 0, R, '#333');
  }

  // Generate trace for smoothness
  traceX = []; traceY = [];
  for(let i=0; i<=t; i+=0.05) {
    if (type==='cycloid') {
      traceX.push(r * i - d * Math.sin(i)); traceY.push(r - d * Math.cos(i));
    } else if (type==='epicycloid') {
      traceX.push((R+r)*Math.cos(i)-d*Math.cos((R+r)/r*i));
      traceY.push((R+r)*Math.sin(i)-d*Math.sin((R+r)/r*i));
    } else {
      traceX.push((R-r)*Math.cos(i)+d*Math.cos((R-r)/r*i));
      traceY.push((R-r)*Math.sin(i)-d*Math.sin((R-r)/r*i));
    }
  }

  const rollingWheel = createCircle(cx, cy, r, '#2196f3', true);
  
  Plotly.react('plot', [
    ...baseData,
    { x: traceX, y: traceY, mode: 'lines', line: {color: '#e91e63', width: 3} },
    ...rollingWheel,
    { x: [cx, px], y: [cy, py], mode: 'lines+markers', marker: {size: 8, color: 'black'}, line: {color: '#555'} }
  ], {
    xaxis: { range: [type==='cycloid'?-2:-12, type==='cycloid'?35:12], scaleanchor: "y" },
    yaxis: { range: [-12, 12] },
    showlegend: false, hovermode: false
  });
}

function createCircle(x, y, r, color, dashed=false) {
  const ptsX = [], ptsY = [];
  for(let a=0; a<=2*Math.PI+0.1; a+=0.1) {
    ptsX.push(x + r * Math.cos(a));
    ptsY.push(y + r * Math.sin(a));
  }
  return [{ x: ptsX, y: ptsY, mode: 'lines', line: {color: color, dash: dashed?'dot':'solid'} }];
}

window.onload = updatePlot;
</script>
</body>
</html>